System.register("chunks:///_virtual/Data.ts",["cc"],(function(t){"use strict";var i;return{setters:[function(t){i=t.cclegacy}],execute:function(){i._RF.push({},"81fe1GDHlRP6IC+Uz3mUa1t","Data",void 0);t("FrameData",function(){function t(){this.frame=-1,this.mapSize=0,this.mapData=[],this.playerCount=0,this.players=[]}return t.prototype.reset=function(){this.frame=-1,this.players.splice(0,this.players.length)},t}()),t("PlayerData",function(){function t(){this.id=null,this.rotation=0,this.x=0,this.y=0}return t.prototype.reset=function(){this.rotation=0,this.id=null,this.x=0,this.y=0},t}());i._RF.pop()}}}));

System.register("chunks:///_virtual/DataFactory.ts",["cc","./Data.ts"],(function(a){"use strict";var t,e,o;return{setters:[function(a){t=a.cclegacy},function(a){e=a.FrameData,o=a.PlayerData}],execute:function(){t._RF.push({},"5c1697J7GxOeLiFJVoOqhmO","DataFactory",void 0);a("default",function(){function a(){this._preDelFrameDataPool=null,this._frameDataPool=null,this._playerDataPool=null,this._preDelFrameDataPool=[],this._frameDataPool=[],this._playerDataPool=[]}var t=a.prototype;return t.exePreDelQueue=function(){for(;this._preDelFrameDataPool.length>0;){var a=this._preDelFrameDataPool.pop();this.addFrameDataToPool(a)}},t.addFrameDataToPreDelQueue=function(a){this._preDelFrameDataPool.push(a)},t.addFrameDataToPool=function(a){for(var t=0;t<a.players.length;t++){var e=a.players.pop();e.reset(),this._playerDataPool.push(e)}a.reset(),this._frameDataPool.push(a)},t.recoveryFrameData=function(a){for(;a.length>0;){var t=a.pop();this.addFrameDataToPool(t)}},t.createFrameData=function(){return this._frameDataPool.length>0?this._frameDataPool.pop():new e},t.createPlayerData=function(){if(this._playerDataPool.length>0){var a=this._playerDataPool.pop();return a.reset(),a}return new o},a}());t._RF.pop()}}}));

System.register("chunks:///_virtual/LoadingScene.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Map.ts","./Network.ts","./SettlementPanel.ts","./TerritoryProtocol.ts","./NetErrorPanel.ts","./DataFactory.ts"],(function(e){"use strict";var t,a,n,i,r,o,s,l,c,h,m,u,f,_,p,d,g,y;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){r=e.cclegacy,o=e.Camera,s=e.Node,l=e._decorator,c=e.view,h=e.Component},function(e){m=e.default},function(e){u=e.default},function(e){f=e.SettlementPanel},function(e){_=e.TerritoryPackage,p=e.TerritoryMessage,d=e.TerritoryProtocol},function(e){g=e.NetErrorPanel},function(e){y=e.default}],execute:function(){var D,b,v,w,P,R,E,T,N,I,L,S,C,F,x,M,U,z,O;r._RF.push({},"8c8f31HD4BPda6Sr6so8eIe","LoadingScene",void 0);var j=l,k=j.ccclass,H=j.property,B=window.Base64;e("LoadingScene",(D=k("LoadingScene"),b=H(o),v=H(s),w=H(s),P=H(s),R=H(s),E=H(f),T=H(g),N=H(s),D((S=t((L=function(e){function t(){for(var t,a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return t=e.call.apply(e,[this].concat(r))||this,n(t,"uiCamera",S,i(t)),n(t,"mapLayer",C,i(t)),n(t,"playerLayer",F,i(t)),n(t,"iconLayer",x,i(t)),n(t,"teamNodeTemp",M,i(t)),n(t,"settlementPanel",U,i(t)),n(t,"netErrorPanel",z,i(t)),n(t,"logoNode",O,i(t)),t._map=null,t._net=null,t._factory=null,t._frameTime=.04,t._frameDt=0,t._frameIndex=-1,t._frameDatas=[],t._netConnected=!1,t._maploaded=!1,t._gameOver=!1,t._netError=!1,t._joinRoomFailTimes=0,t._remoteFrame=0,t._debug=5,t._mapData={rows:30,cols:40,gridWid:20,gridHei:20,players:null},t}a(t,e);var r=t.prototype;return r.onNetDisconnect=function(){this._debug>=1&&console.log("Net.onNetDisconnect"),this._netError||(this._netError=!0,0==this.netErrorPanel.isShow&&this.netErrorPanel.showUI())},r.onNetReconnect=function(){this._debug>=1&&console.log("Net.onNetReconnect"),this._netError&&(this._netError=!1)},r.setDebug=function(e){this._net&&this._net.setDebug(e)},r.onPushMsg=function(e,t){var a=this;if("onJoin"==e)this._mapData.rows=parseInt(t.row),this._mapData.cols=parseInt(t.column),this._mapData.gridWid=parseInt(t.cell_width),this._mapData.gridHei=parseInt(t.cell_height),this._mapData.players=t.players,this._netConnected=!0,this._frameIndex=-1,this._factory.recoveryFrameData(this._frameDatas),this.checkGameReady();else if("onStop"==e)if(0==this._gameOver){this._gameOver=!0;var n={winner:t.winner,cd:t.next_count_down};this.settlementPanel.showUI(n,(function(){a._gameOver=!1,a.settlementPanel.closeUI(),a._net.request("game.join",{},a.onGameJoinRes.bind(a))}))}else this._debug>=1&&console.error("The game is over!");else if("onUpdate"==e)if(B){var i=this._factory.createFrameData(),r=B.toUint8Array(t.data),o=new DataView(r.buffer),s=0,l=o.getUint32(s);s+=4,i.frame=l;var c=o.getUint32(s);s+=4,i.mapSize=c;for(var h=0,m=0;m<c;m++){var u=o.getInt8(s),f=(240&u)>>4,_=15&u;i.mapData[h]=f,h+=1,i.mapData[h]=_,h+=1,s+=1}i.playerCount=o.getUint32(s),s+=4;var p=!1;-1==this._frameIndex&&(this._frameIndex=i.frame,p=!0,this.iconLayer.active=!0);for(var d=0;d<i.playerCount;d++){var g=this._factory.createPlayerData();o.getBigUint64 instanceof Function?g.id=o.getBigUint64(s)+"":this._debug>=1&&console.error("[ERROR] DataView.getBigUint64 function not found!"),s+=8,g.rotation=o.getInt16(s),s+=2,g.x=o.getFloat64(s),s+=8,g.y=o.getFloat64(s),s+=8,i.players.push(g),p&&this._map.updatePlayer(g.id,g.x,g.y,!0)}this._remoteFrame=i.frame,this._frameDatas.push(i)}else this._debug>=1&&console.error("Base64 not found!");else this._debug>=1&&console.error("onPushMsg: todo route = ",e)},r.onRequestMsg=function(e,t){this._debug>=3&&console.log("onRequestMsg: route = ",e,", route = ",t)},r.checkGameReady=function(){if(this._maploaded&&this._netConnected){if(this.iconLayer.active=!1,this._map.init(this._mapData.rows,this._mapData.cols,this._mapData.gridWid,this._mapData.gridHei),this._mapData.players)for(var e=0;e<this._mapData.players.length;e++)this._map.createPlayer(-1,this._mapData.players[e].id+"",!0);else this._debug&&console.error("onJson: players is null!");this._frameDt=this._frameTime}},r.onMapComplete=function(){this._maploaded=!0,this.checkGameReady()},r.connectNetwork=function(){var e=this;this._net.on(u.Event.ON_PUSH,this.onPushMsg,this),this._net.on(u.Event.ON_MSG,this.onRequestMsg,this),this._net.on(u.Event.DISCONNECT,this.onNetDisconnect,this),this._net.on(u.Event.RECONNECT,this.onNetReconnect,this),this._net.on(u.Event.HEARTBEAT_TIMEOUT,this.onNetReconnect,this),this._net.init({url:"ws://3.1.100.155:3250",package:new _,message:new p,protocol:new d,maxReconnectAttempts:50,needSeedHandshake:!0,reconnect:!0,debug:this._debug},(function(){e.joinRoom()}))},r.onGameJoinRes=function(e){var t=this;this._debug>=3&&console.log("request: data = ",e),0==e.code?(this._joinRoomFailTimes=0,this.netErrorPanel.closeUI()):(this._joinRoomFailTimes+=1,setTimeout((function(){t.joinRoom()}),2e3*this._joinRoomFailTimes))},r.joinRoom=function(){this._net.request("game.join",{},this.onGameJoinRes.bind(this))},r.onLoad=function(){var e=c.getVisibleSize();this.uiCamera.orthoHeight=e.height/2,this.iconLayer.active=!1,this._net=new u,this._factory=new y,this._map=new m(this.mapLayer,this.playerLayer,this.teamNodeTemp),this._map.on(m.Event.LOAD_COMPLETE,this.onMapComplete,this),this._map.load(),this.connectNetwork()},r.update=function(e){if(this._frameDt+=e,this._factory.exePreDelQueue(),this._frameDt>=this._frameTime&&(this._frameTime=0,this._frameDatas.length>0)){var t=this._frameDatas[0];if(null!=t)if(t.frame===this._frameIndex){t=this._frameDatas.shift();for(var a=0;a<t.mapData.length;a++)this._map.updateTerritory(a,t.mapData[a]);for(var n=0;n<t.players.length;n++){var i=t.players[n];this._map.updatePlayer(i.id,i.x,i.y,!0)}this._factory.addFrameDataToPreDelQueue(t),this._debug>=3&&console.log("local frame = "+this._frameIndex+", remote frame = "+this._remoteFrame,", diff = ",this._remoteFrame-this._frameIndex),this._frameIndex+=1}else this._frameDatas.sort(this.frameSort.bind(this))}},r.frameSort=function(e,t){return e.frame>t.frame?1:e.frame<t.frame?-1:0},t}(h)).prototype,"uiCamera",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(L.prototype,"mapLayer",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(L.prototype,"playerLayer",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(L.prototype,"iconLayer",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(L.prototype,"teamNodeTemp",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(L.prototype,"settlementPanel",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(L.prototype,"netErrorPanel",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(L.prototype,"logoNode",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=L))||I));r._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./LoadingScene.ts","./MapTest.ts","./NFTSDK.ts","./Net.ts","./Data.ts","./DataFactory.ts","./Map.ts","./Player.ts","./Territory.ts","./Network.ts","./ProtocolBase.ts","./TerritoryProtocol.ts","./NetErrorPanel.ts","./SettlementPanel.ts"],(function(){"use strict";return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/Map.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Territory.ts","./Player.ts"],(function(t){"use strict";var e,i,r,o,a,s,n,l,d,h,_,p,u;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,r=t.resources,o=t.SpriteFrame,a=t.instantiate,s=t.Sprite,n=t.UITransform,l=t.Node,d=t.Color,h=t.color,_=t.EventTarget},function(t){p=t.Territory},function(t){u=t.Player}],execute:function(){i._RF.push({},"77ea825CDZMyZpgSDM0DHTr","Map",void 0),t("default",function(t){function i(e,i,r){var o;return(o=t.call(this)||this)._mapLayer=null,o._playerLayer=null,o._rows=30,o._cols=40,o._gridNodeTemp=null,o._gridWid=20,o._gridHei=20,o._territorys=null,o._avatars=null,o._players=null,o._loaded=!1,o._teamColors=null,o._mapOffsetX=0,o._mapOffsetY=0,o._mapWidth=840,o._mapHeight=630,o._gridNodePool=[],o._playerNodePool=[],o._mapLayer=e,o._playerLayer=i,o._gridNodeTemp=r,o._territorys=new Array,o._avatars=[],o._players={},o._teamColors=[d.WHITE,h(240,187,16),h(98,126,234),h(130,71,229),h(247,147,26),h(232,65,66)],o}e(i,t);var _=i.prototype;return _.init=function(t,e,i,r){if(this._rows=t,this._cols=e,this._gridWid=i,this._gridHei=r,this._players)for(var o in this._players){var a=this._players[o];a&&(this._playerLayer.removeChild(a.node),this._playerNodePool.push(a))}this._players={},this.createMap()},_.load=function(){this._loaded=!1,r.loadDir("./avatars",o,this.onLoadResComplete.bind(this))},_.onLoadResComplete=function(t,e){if(t)return console.error("avatar load error!"),void this.emit(i.Event.LOAD_ERROR);console.log("game load complete.");for(var r=0;r<e.length;r++)e[r].addRef(),this._avatars.push(e[r]);this._loaded=!0,this.emit(i.Event.LOAD_COMPLETE),console.log("game init complete. avatar count = "+this._avatars.length)},_.createMap=function(){for(var t=0;t<this._territorys.length;t++){var e=this._territorys[t];e&&(e.node.parent=null,this._gridNodePool.push(e))}this._territorys.splice(0,this._territorys.length);for(var i=this._rows,r=this._cols,o=this._gridWid,l=this._gridHei,d=-(r*o+r)/2+o/2,h=(i*l+i)/2-l/2,_=0;_<i;_++)for(var u=0;u<r;u++){var f=this._gridNodePool.pop(),y=null;null==f?(f=(y=a(this._gridNodeTemp)).addComponent(p),y.active=!0):f=(y=f.node).getComponent(p),y.getComponent(s).color=this._teamColors[0],this._mapLayer.addChild(y);var m=y.getComponent(n);m&&m.setContentSize(this._gridWid,this._gridHei),y.setPosition(d+u*(o+1),h-_*(l+1)),f.gridX=u,f.gridY=_,f.teamId=-1,f.map=this,f.index=f.gridY*r+f.gridX,this._territorys[f.index]=f}this._mapOffsetX=d,this._mapOffsetY=h},_.gridToMapPosition=function(t,e,i){i&&(i.x=this._mapOffsetX+t*(this._gridWid+1),i.y=this._mapOffsetY-e*(this._gridHei+1))},_.indexToMapPosition=function(t,e){if(e){var i=Math.floor(t%this._cols),r=Math.floor(t/this._cols);e.x=this._mapOffsetX+i*(this._gridWid+1),e.y=this._mapOffsetY-r*(this._gridHei+1)}},_.gridToIndex=function(t,e){return e*this._cols+t},_.mapToGrid=function(t,e){e.x=Math.floor((t.x-this._mapOffsetX)/(this._gridWid+1)),e.y=Math.floor((-t.y+this._mapOffsetY)/(this._gridHei+1))},_.createPlayer=function(t,e,i,r){void 0===i&&(i=!1),void 0===r&&(r=-1);var o=null,a=this._playerNodePool.pop(),d=null,h=null;return null!=a?((o=a.node).name="team_"+t,d=o.getComponent(n),h=o.getComponent(s)):(a=(o=new l("team_"+t)).addComponent(u),d=o.addComponent(n),h=o.addComponent(s)),o.layer=this._playerLayer.layer,o.setPosition(4*this._mapWidth,50*this._playerLayer.children.length),null==this._avatars[r]&&(r=Math.ceil((this._avatars.length-1)*Math.random())),h.spriteFrame=this._avatars[r],h.sizeMode=s.SizeMode.CUSTOM,d.setContentSize(30,30),d.setAnchorPoint(0,1),a.width=30,a.height=30,a.teamId=t,a.playerId=e,a.map=this,i&&this.addPlayer(a),a},_.addPlayer=function(t){this._playerLayer.addChild(t.node),this._players[t.playerId]=t},_.updatePlayer=function(t,e,i,r){void 0===r&&(r=!1);var o=this._players[t];o&&o.setPosition(this._mapOffsetX+e-o.width/2,this._mapOffsetY-i+o.height/2,r)},_.updateTerritory=function(t,e){var i=this._teamColors[e],r=this._territorys[t];i&&r&&(r.teamId=e,r.color=i)},_.getTerritoryTeamId=function(t){return null==this._territorys[t]?-2:this._territorys[t].teamId},_.getTerritory=function(t){return null==this._territorys[t]?null:this._territorys[t]},_.checkMapBox=function(t){},i}(_)).Event={LOAD_COMPLETE:"LOAD_COMPLETE",LOAD_ERROR:"LOAD_ERROR",LOAD_PROGRESS:"LOAD_PROGRESS"},i._RF.pop()}}}));

System.register("chunks:///_virtual/MapTest.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){"use strict";var e,a,r,i;return{setters:[function(t){e=t.inheritsLoose},function(t){a=t.cclegacy,r=t._decorator,i=t.Component}],execute:function(){var s;a._RF.push({},"aaa6fy0K6JCgpNlsarmK29i","MapTest",void 0);var n=r.ccclass;r.property,t("MapTest",n("MapTest")(s=function(t){function a(){for(var e,a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this)._map=null,e}e(a,t);var r=a.prototype;return r.start=function(){},r.update=function(t){},r.createCamp=function(){for(var t=[243,244,245,246,247,248,249,204,205,206,207,208,165,166,167,126,284,285,286,287,288,325,326,327,366],e=[270,271,272,273,274,275,276,231,232,233,234,235,192,193,194,153,311,312,313,314,315,352,353,354,393],a=[923,924,925,926,927,928,929,884,885,886,887,888,845,846,847,806,964,965,966,967,968,1005,1006,1007,1046],r=[950,951,952,953,954,955,956,911,912,913,914,915,872,873,874,833,991,992,993,994,995,1032,1033,1034,1073],i=0;i<e.length;i++)this._map.updateTerritory(t[i],0),this._map.updateTerritory(e[i],1),this._map.updateTerritory(a[i],2),this._map.updateTerritory(r[i],3)},r.createPlayer=function(){var t=this._map.createPlayer(0,"1");t.setIndexPosition(246),this._map.addPlayer(t);var e=this._map.createPlayer(1,"2");e.setIndexPosition(273),this._map.addPlayer(e);var a=this._map.createPlayer(2,"3");a.setIndexPosition(926),this._map.addPlayer(a);var r=this._map.createPlayer(3,"4");r.setIndexPosition(953),this._map.addPlayer(r)},a}(i))||s);a._RF.pop()}}}));

System.register("chunks:///_virtual/Net.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var n,o,t,r;return{setters:[function(e){n=e.inheritsLoose,o=e.assertThisInitialized},function(e){t=e.cclegacy,r=e.EventTarget}],execute:function(){t._RF.push({},"1c72b23+dZOzYb/hCPqZSOA","Net",void 0),e("default",function(e){function t(n){var t;return(t=e.call(this)||this)._ws=null,t._ws=new WebSocket(n),t._ws.binaryType="arraybuffer",t._ws.onopen=t.onOpen.bind(o(t)),t._ws.onmessage=t.onMessage.bind(o(t)),t._ws.onerror=t.onError.bind(o(t)),t._ws.onclose=t.onClose.bind(o(t)),t}n(t,e);var r=t.prototype;return r.onOpen=function(e,n){console.log("ws.protocol = "+e.protocol,e.binaryType);var o=new ArrayBuffer(1),t=new DataView(o);t.setUint8(0,1),this._ws.send(t.buffer)},r.onMessage=function(e){if(e.data){var n=new DataView(e.data),o={id:n.getInt32(0),x:n.getFloat64(4),y:n.getFloat64(12)};console.log("kkkkk: ",o),this.emit(t.Event.PUSH_MSG,o)}else console.error("onMessage err, data = ",e.data)},r.onError=function(e){console.log("onError = ",e)},r.onClose=function(e){console.log("onClose = ",e)},t}(r)).Event={PUSH_MSG:"PUSH_MSG"},t._RF.pop()}}}));

System.register("chunks:///_virtual/NetErrorPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var t,r,n,o,c;return{setters:[function(e){t=e.inheritsLoose,r=e.createClass},function(e){n=e.cclegacy,o=e._decorator,c=e.Component}],execute:function(){var i;n._RF.push({},"ff00fUbRgxOHIAOw3hlAkg+","NetErrorPanel",void 0);var s=o.ccclass;e("NetErrorPanel",s("NetErrorPanel")(i=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var o=n.prototype;return o.showUI=function(){this.node.active=!0},o.closeUI=function(){this.node.active=!1},r(n,[{key:"isShow",get:function(){return this.node.active}}]),n}(c))||i);n._RF.pop()}}}));

System.register("chunks:///_virtual/Network.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var t,s,i,n;return{setters:[function(e){t=e.inheritsLoose,s=e.createClass},function(e){i=e.cclegacy,n=e.EventTarget}],execute:function(){i._RF.push({},"c0e29JjGGREX6dRXVk+Fm+t","Network",void 0);e("default",function(e){function i(){var t;return(t=e.call(this)||this)._initCallback=null,t._handshakeCallback=null,t._maxReconnectAttempts=3,t._maxHeartbeatTimeoutTimes=2,t._gapThreshold=100,t._reconnectionDelay=5e3,t._needSeedHandshake=!0,t._reconnectUrl=null,t._reconnect=!1,t._reconnectAttempts=0,t._reconncetTimer=0,t._socket=null,t._handlers={},t._callbacks={},t._reqId=0,t._routeMap={},t._dict={},t._abbrs={},t._heartbeatId=0,t._heartbeatTimeout=0,t._heartbeatTimeoutId=-1,t._nextHeartbeatTimeout=0,t._heartbeatInterval=0,t._encode=null,t._decode=null,t._package=null,t._message=null,t._protocol=null,t._debug=0,t.disconnect=function(){if(this._socket){var e=this._socket;e.disconnect&&e.disconnect(),e.close&&e.close(),this._debug>=3&&console.info("Network: disconnect")}this._heartbeatId>0&&(clearTimeout(this._heartbeatId),this._heartbeatId=0),this._heartbeatTimeoutId>-1&&(clearTimeout(this._heartbeatTimeoutId),this._heartbeatTimeoutId=-1)},t}t(i,e);var n=i.prototype;return n.setDebug=function(e){this._debug=e,this._package.setDebug(this._debug),this._message.setDebug(this._debug)},n.init=function(e,t){this._initCallback=t,this._package=e.package,this._message=e.message,this._protocol=e.protocol,this._debug=e.debug||this._debug,null!=this._package&&null!=this._message&&null!=this._protocol?(this._protocol.owner=this,this._message.owner=this,this._package.owner=this,this._protocol.setDebug(this._debug),this._package.setDebug(this._debug),this._message.setDebug(this._debug),this._encode=e.encode||this.defaultEncode,this._decode=e.decode||this.defaultDecode,this._maxReconnectAttempts=e.maxReconnectAttempts||this._maxReconnectAttempts,this._maxHeartbeatTimeoutTimes=e.maxHeartbeatTimeoutTimes||this._maxHeartbeatTimeoutTimes,null!=e.needSeedHandshake&&(this._needSeedHandshake=e.needSeedHandshake),this._reqId=0,this._handshakeCallback=e.handshakeCallback,this.connect(e,e.url,t)):this._debug>=1&&console.error("Network: init Fail!")},n.connect=function(e,t,s){this._debug>=3&&console.info("Network.connect: url = "+t),this._reconnectUrl=t;var n=e||{},o=this;this.initHandlers(),this._socket=new WebSocket(t),this._socket.binaryType="arraybuffer",this._socket.onopen=this.onOpen.bind(this),this._socket.onmessage=this.onMessage.bind(this),this._socket.onerror=this.onError.bind(this),this._socket.onclose=function(e){o.emit(i.Event.CLOSE,e),o.emit(i.Event.DISCONNECT,e),this._debug>=1&&console.error("Network.onClose: reconnect = ",n.reconnect+", reconnect time = "+Math.ceil(o._reconnectionDelay/1e3)),n.reconnect&&o._reconnectAttempts<o._maxReconnectAttempts&&(o._reconnect=!0,o._reconnectAttempts++,o._reconncetTimer=setTimeout((function(){o.connect(n,o._reconnectUrl,s)}),o._reconnectionDelay),o._reconnectionDelay*=2)}},n.initHandlers=function(){this._handlers[this._package.TYPE_HANDSHAKE]=this.handshake.bind(this),this._handlers[this._package.TYPE_HEARTBEAT]=this.heartbeat.bind(this),this._handlers[this._package.TYPE_DATA]=this.onData.bind(this),this._handlers[this._package.TYPE_KICK]=this.onKick.bind(this)},n.request=function(e,t,s){2===arguments.length&&"function"==typeof t?(s=t,t={}):t=t||{},(e=e||t.route)&&(this._reqId++,this.sendMessage(this._reqId,e,t),this._callbacks[this._reqId]=s,this._routeMap[this._reqId]=e)},n.notify=function(e,t){t=t||{},this.sendMessage(0,e,t)},n.sendMessage=function(e,t,s){this._debug>=3&&console.log("Network.sendMessage: reqId = "+e+", route = "+t+", msg = "+JSON.stringify(s)),this._encode&&(s=this._encode(e,t,s));var i=this._package.encode(this._package.TYPE_DATA,s);this.send(i)},n.onOpen=function(e){if(this._debug>=3&&console.log("Network.onOpen: ws open"),1==this._reconnect&&this.emit(i.Event.RECONNECT),this.reset(),1==this._needSeedHandshake){this._debug>=3&&console.log("Network.onOpen: send handshake");var t=this._package.encode(this._package.TYPE_HANDSHAKE,this._package.strencode(JSON.stringify(this._package.handshakeBuffer)));this.send(t.buffer)}},n.reset=function(){this._reconnect=!1,this._reconnectionDelay=5e3,this._reconnectAttempts=0,this._reconncetTimer>0&&(clearTimeout(this._reconncetTimer),this._reconncetTimer=0)},n.onMessage=function(e){this.processPackage(this._package.decode(e.data)),this._heartbeatTimeout&&(this._nextHeartbeatTimeout=Date.now()+this._heartbeatTimeout)},n.onError=function(){this.emit(i.Event.IO_ERROR),this._debug>=1&&console.error("Network.onError: io-error")},n.send=function(e){this._socket&&this._socket.send(e)},n.processPackage=function(e){if(null!=e)if(Array.isArray(e))for(var t=0;t<e.length;t++){var s=e[t],i=this._package.getPckType(s),n=this._handlers[i];if(null!=n)n(this._package.getPckBody(s));else this._debug>=2&&console.warn("Network.processPackage.Array: handler not found, type = "+s.type)}else{var o=this._package.getPckType(e),a=this._handlers[o];if(null!=a)a(this._package.getPckBody(e));else this._debug>=2&&console.warn("Network.processPackage: handler not found, type = "+e.type)}else this._debug>=1&&console.error("Network.processPackage: msgs is null!")},n.processMessage=function(e){if(e.id){var t=this._callbacks[e.id];delete this._callbacks[e.id],"function"==typeof t&&(t(e.body),this.emit(i.Event.ON_MSG,e.route,e))}else this.emit(i.Event.ON_PUSH,e.route,e.body)},n.heartbeat=function(){var e=this;if(!(this._heartbeatInterval<=0||(this._heartbeatTimeoutId&&(clearTimeout(this._heartbeatTimeoutId),this._heartbeatTimeoutId=0),this._heartbeatId))){var t=this._package.encode(this._package.TYPE_HEARTBEAT);this._heartbeatId=setTimeout((function(){e._heartbeatId=0,e.send(t.buffer),e._nextHeartbeatTimeout=Date.now()+e._heartbeatTimeout,e._heartbeatTimeoutId=setTimeout(e.heartbeatTimeoutCb.bind(e),e._heartbeatTimeout)}),this._heartbeatInterval)}},n.heartbeatTimeoutCb=function(){var e=this._nextHeartbeatTimeout-Date.now();e>this._gapThreshold?this._heartbeatTimeoutId=setTimeout(this.heartbeatTimeoutCb.bind(this),e):(this.emit(i.Event.HEARTBEAT_TIMEOUT),this._debug>=3&&console.error("Network: heartbeat timeout"),this.disconnect())},n.handshake=function(e){var t=this._protocol.strdecode(e),s=JSON.parse(t);if(this._debug>=3&&console.log("Network.handshake: data = "+t),501===s.code)return this.emit(i.Event.RES_ERROR,s.code,"client version old!"),void console.error("Network: client version old!");if(200!==s.code)return this.emit(i.Event.RES_ERROR,s.code,"handshake fail!"),void(this._debug>=1&&console.error("Network: handshake fail!"));this.handshakeInit(s);var n=this._package.encode(this._package.TYPE_HANDSHAKE_ACK);this.send(n.buffer),this._initCallback&&this._initCallback(this)},n.handshakeInit=function(e){e.sys&&e.sys.heartbeat?(this._heartbeatInterval=1e3*e.sys.heartbeat,this._heartbeatTimeout=this._heartbeatInterval*this._maxHeartbeatTimeoutTimes):(this._heartbeatInterval=0,this._heartbeatTimeout=0),this.initData(e),this._handshakeCallback instanceof Function&&this._handshakeCallback(e.user)},n.initData=function(e){if(e&&e.sys){var t=e.sys.dict;if(t)for(var s in this._dict=t,this._abbrs={},t)this._abbrs[t[s]]=s}},n.onData=function(e){var t=e;this._decode&&(t=this._decode(t)),this.processMessage(t)},n.onKick=function(e){this.emit(i.Event.ON_KICK,e)},n.defaultEncode=function(e,t,s){var i=e?this._message.TYPE_REQUEST:this._message.TYPE_NOTIFY;s=this._protocol.strencode(JSON.stringify(s));var n=0;return this._dict&&this._dict[t]&&(t=this._dict[t],n=1),this._message.encode(e,i,n,t,s)},n.defaultDecode=function(e){var t=this._message.decode(e);if(!(t.id>0)||(t.route=this._routeMap[t.id],delete this._routeMap[t.id],t.route))return t.body=this.deCompose(t),t},n.deCompose=function(e){var t=e.route;if(e.compressRoute){if(!this._abbrs[t])return{};t=e.route=this._abbrs[t]}var s=this._protocol.strdecode(e.body);return JSON.parse(s)},n.emit=function(t,s,i){void 0===s&&(s=null),void 0===i&&(i=null),e.prototype.emit.call(this,t,s,i)},s(i,[{key:"message",get:function(){return this._message}},{key:"protocol",get:function(){return this._protocol}},{key:"package",get:function(){return this._package}}]),i}(n)).Event={CLOSE:"close",DISCONNECT:"disconnect",RECONNECT:"reconnect",IO_ERROR:"io-error",RES_ERROR:"error",HEARTBEAT_TIMEOUT:"heartbeat_timeout",ON_KICK:"onKick",ON_MSG:"onMsg",ON_PUSH:"onPush"},i._RF.pop()}}}));

System.register("chunks:///_virtual/NFTSDK.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){"use strict";var e,n,o,a;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,o=t._decorator,a=t.Component}],execute:function(){var r;n._RF.push({},"592b5MOhWhJ66H+RDz5Wxz6","NFTSDK",void 0);var c=o.ccclass,s=(o.property,t("nftsdk",window.nftsdk||{createNTFFromGame:function(t){console.error("not found ntfsdk.createNTFFromGame Function."),t&&t.cb&&t.cb(t.id)},gameInit:function(){console.error("not found ntfsdk.gameInit Function.")},gameLoadProgress:function(t){console.error("not found ntfsdk.gameLoadProgress Function.")},gameInitComplete:function(){console.error("not found ntfsdk.gameInitComplete Function.")},getUserData:function(t){console.error("not found ntfsdk.getUserData Function."),t&&t({assets:[]})},setUpdateUserDataCallback:function(t){console.error("not found ntfsdk.setUpdateUserDataCallback Function."),window.rpggame.updateUserDataCallback=t}}));t("NFTSDK",c("NFTSDK")(r=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var o=n.prototype;return o.gameInit=function(){s&&s.gameInit&&s.gameInit()},o.gameInitComplete=function(){s&&s.gameInitComplete&&s.gameInitComplete()},o.createNTFFromGame=function(t,e){s&&s.createNTFFromGame&&s.createNTFFromGame({id:t,cb:e})},o.getUserInfo=function(t){s&&s.getUserData&&s.getUserData(t)},o.setUpdateUserDataCallback=function(t){s&&s.setUpdateUserDataCallback&&s.setUpdateUserDataCallback(t)},n}(a))||r);n._RF.pop()}}}));

System.register("chunks:///_virtual/Player.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){"use strict";var o,e,i,n,s,a;return{setters:[function(t){o=t.inheritsLoose},function(t){e=t.cclegacy,i=t.math,n=t._decorator,s=t.v3,a=t.Component}],execute:function(){var r;e._RF.push({},"e2315bDb2JLZYwJGIl58vZh","Player",void 0);var c=n,h=c.ccclass;c.property,t("Player",h("Player")(r=function(t){function e(){for(var o,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return(o=t.call.apply(t,[this].concat(i))||this).playerId=null,o.teamId=0,o.map=null,o.speed=.1,o.width=30,o.height=30,o._pos=s(0,0),o._targetPos={x:0,y:0},o._offsetX=0,o._offsetY=0,o._angel=0,o._gridPos={x:0,y:0},o}o(e,t);var n=e.prototype;return n.setPosition=function(t,o,e){this._targetPos.x=t,this._targetPos.y=o,e&&this.node.setPosition(t,o)},n.setGridPosition=function(t,o){this.map.gridToMapPosition(t,o,this.node.position)},n.setIndexPosition=function(t){this.map.indexToMapPosition(t,this.node.position)},n.setMoveAngel=function(t){this._angel=t;var o=i.toRadian(this._angel);this._offsetX=Math.cos(o)*this.speed,this._offsetY=Math.sin(o)*this.speed},n.onLoad=function(){},n.update=function(t){},e}(a))||r);e._RF.pop()}}}));

System.register("chunks:///_virtual/ProtocolBase.ts",["cc"],(function(t){"use strict";var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"ed5beNOzSlDZYy6Gm/+xJkk","ProtocolBase",void 0);var n=t("copyByteArray",(function(t,e,n,r,s){for(var o=0;o<s;o++)t[e++]=n[r++]}));t("ProtocolBase",function(){function t(){this.owner=null,this._debug=0}var e=t.prototype;return e.setDebug=function(t){this._debug=t},e.strencode=function(t){for(var e=new Uint8Array(3*t.length),r=0,s=0;s<t.length;s++){var o=t.charCodeAt(s),i=null;i=o<=127?[o]:o<=2047?[192|o>>6,128|63&o]:[224|o>>12,128|(4032&o)>>6,128|63&o];for(var h=0;h<i.length;h++)e[r]=i[h],++r}var u=new Uint8Array(r);return n(u,0,e,0,r),u},e.strdecode=function(t){for(var e=new Uint8Array(t),n=[],r=0,s=0,o=e.length;r<o;)e[r]<128?(s=e[r],r+=1):e[r]<224?(s=((63&e[r])<<6)+(63&e[r+1]),r+=2):(s=((15&e[r])<<12)+((63&e[r+1])<<6)+(63&e[r+2]),r+=3),n.push(s);return String.fromCharCode.apply(null,n)},t}()),t("PackageBase",function(){function t(){this.TYPE_HANDSHAKE=1,this.TYPE_HANDSHAKE_ACK=2,this.TYPE_HEARTBEAT=3,this.TYPE_DATA=4,this.TYPE_KICK=5,this.PKG_HEAD_BYTES=4,this.JS_WS_CLIENT_TYPE="js-websocket",this.JS_WS_CLIENT_VERSION="0.0.1",this.owner=null,this._debug=0,this.handshakeBuffer={sys:{type:this.JS_WS_CLIENT_TYPE,version:this.JS_WS_CLIENT_VERSION},user:{}}}var e=t.prototype;return e.setDebug=function(t){this._debug=t},e.getPckType=function(t){return t.type},e.getPckBody=function(t){return t.body},e.strencode=function(t){for(var e=new Uint8Array(3*t.length),r=0,s=0;s<t.length;s++){var o=t.charCodeAt(s),i=null;i=o<=127?[o]:o<=2047?[192|o>>6,128|63&o]:[224|o>>12,128|(4032&o)>>6,128|63&o];for(var h=0;h<i.length;h++)e[r]=i[h],++r}var u=new Uint8Array(r);return n(u,0,e,0,r),u},e.encode=function(t,e){void 0===e&&(e=null);var r=e?e.length:0,s=new Uint8Array(this.PKG_HEAD_BYTES+r),o=0;return s[o++]=255&t,s[o++]=r>>16&255,s[o++]=r>>8&255,s[o++]=255&r,e&&n(s,4,e,0,r),s},e.decode=function(t){for(var e=0,r=new Uint8Array(t),s=0,o=[];e<r.length;){var i=r[e++],h=(s=(r[e++]<<16|r[e++]<<8|r[e++])>>>0)?new Uint8Array(s):null;n(h,0,r,e,s),e+=s,o.push({type:i,body:h})}return 1===o.length?o[0]:o},t}()),t("MessageBase",function(){function t(){this.TYPE_REQUEST=0,this.TYPE_NOTIFY=1,this.TYPE_RESPONSE=2,this.TYPE_PUSH=3,this.MSG_FLAG_BYTES=1,this.MSG_ROUTE_CODE_BYTES=2,this.MSG_ROUTE_LEN_BYTES=1,this.MSG_ROUTE_CODE_MAX=65535,this.MSG_COMPRESS_ROUTE_MASK=1,this.MSG_TYPE_MASK=7,this.owner=null,this._debug=0}var e=t.prototype;return e.setDebug=function(t){this._debug=t},e.getMsgBody=function(t){return t.msg},e.msgHasId=function(t){return t===this.TYPE_REQUEST||t===this.TYPE_RESPONSE},e.encodeMsgId=function(t,e,n){do{var r=t%128,s=Math.floor(t/128);0!==s&&(r+=128),e[n++]=r,t=s}while(0!==t);return n},e.caculateMsgIdBytes=function(t){var e=0;do{e+=1,t>>=7}while(t>0);return e},e.msgHasRoute=function(t){return t===this.TYPE_REQUEST||t===this.TYPE_NOTIFY||t===this.TYPE_PUSH},e.encodeMsgFlag=function(t,e,n,r){if(t!==this.TYPE_REQUEST&&t!==this.TYPE_NOTIFY&&t!==this.TYPE_RESPONSE&&t!==this.TYPE_PUSH)throw new Error("MessageBase.encodeMsgFlag: unkonw message type = "+t);return n[r]=t<<1|(e?1:0),r+this.MSG_FLAG_BYTES},e.encodeMsgBody=function(t,e,r){return n(e,r,t,0,t.length),r+t.length},e.encodeMsgRoute=function(t,e,r,s){if(t){if(e>this.MSG_ROUTE_CODE_MAX)throw new Error("MessageBase.encodeMsgRoute: route number is overflow");r[s++]=e>>8&255,r[s++]=255&e}else e?(r[s++]=255&e.length,n(r,s,e,0,e.length),s+=e.length):r[s++]=0;return s},e.encode=function(t,e,n,r,s){var o=this.msgHasId(e)?this.caculateMsgIdBytes(t):0,i=this.MSG_FLAG_BYTES+o;if(this.msgHasRoute(e))if(n){if("number"!=typeof r)throw new Error("MessageBase.encode: error flag for number route!");i+=this.MSG_ROUTE_CODE_BYTES}else if(i+=this.MSG_ROUTE_LEN_BYTES,r){if((r=this.owner.protocol.strencode(r)).length>255)throw new Error("MessageBase.encode: route maxlength is overflow");i+=r.length}s&&(i+=s.length);var h=new Uint8Array(i),u=0;return u=this.encodeMsgFlag(e,n,h,u),this.msgHasId(e)&&(u=this.encodeMsgId(t,h,u)),this.msgHasRoute(e)&&(u=this.encodeMsgRoute(n,r,h,u)),s&&(u=this.encodeMsgBody(s,h,u)),h},e.decode=function(t){var e=new Uint8Array(t),r=e.length||e.byteLength,s=0,o=0,i=null,h=e[s++],u=h&this.MSG_COMPRESS_ROUTE_MASK,a=h>>1&this.MSG_TYPE_MASK;if(this.msgHasId(a)){var _=parseInt(e[s].toString()),E=0;do{o+=(127&(_=parseInt(e[s].toString())))*Math.pow(2,7*E),s++,E++}while(_>=128)}if(this.msgHasRoute(a))if(u)i=e[s++]<<8|e[s++];else{var c=e[s++];c?(i=new Uint8Array(c),n(i,0,e,s,c),i=this.owner.protocol.strdecode(i)):i="",s+=c}var g=r-s,l=new Uint8Array(g);return n(l,0,e,s,g),{id:o,type:a,compressRoute:u,route:i,body:l}},t}());e._RF.pop()}}}));

System.register("chunks:///_virtual/SettlementPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){"use strict";var e,i,n,l,s,c,a,r,o;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,l=t.assertThisInitialized},function(t){s=t.cclegacy,c=t.Node,a=t.Label,r=t._decorator,o=t.Component}],execute:function(){var h,d,u,m,b,p,f,_,v;s._RF.push({},"7f5d27KnPtDRaDtOYxmnk7b","SettlementPanel",void 0);var g=r,y=g.ccclass,T=g.property;t("SettlementPanel",(h=y("SettlementPanel"),d=T([c]),u=T([c]),m=T(a),h((f=e((p=function(t){function e(){for(var e,i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return e=t.call.apply(t,[this].concat(s))||this,n(e,"teamIcons",f,l(e)),n(e,"teamTitles",_,l(e)),n(e,"lblCd",v,l(e)),e._cd=0,e._callback=null,e}i(e,t);var s=e.prototype;return s.showUI=function(t,e){this.node.active=!0,this._callback=e,t.cd?this._cd=parseInt(t.cd):this._cd=15;for(var i=1;i<this.teamIcons.length;i++)null!=this.teamIcons[i]&&null!=this.teamTitles[i]&&(i==t.winner?(this.teamIcons[i].active=!0,this.teamTitles[i].active=!0):(this.teamIcons[i].active=!1,this.teamTitles[i].active=!1));this._cd>=10?this.lblCd.string="00:"+this._cd:this.lblCd.string="00:0"+this._cd,this.unschedule(this.cdTimeHandler);var n=this._cd;this.schedule(this.cdTimeHandler,1,n,0)},s.cdTimeHandler=function(){if(this._cd-=1,this._cd<=0){this.unschedule(this.cdTimeHandler);var t=this._callback;t&&(t(),this._callback=null)}this._cd>=10?this.lblCd.string="00:"+this._cd:this.lblCd.string="00:0"+this._cd},s.closeUI=function(){this.node.active=!1,this.lblCd.string="00:00",this.unschedule(this.cdTimeHandler)},s.start=function(){},e}(o)).prototype,"teamIcons",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_=e(p.prototype,"teamTitles",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),v=e(p.prototype,"lblCd",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=p))||b));s._RF.pop()}}}));

System.register("chunks:///_virtual/Territory.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(r){"use strict";var t,o,e,n,s,i,c;return{setters:[function(r){t=r.inheritsLoose,o=r.createClass},function(r){e=r.cclegacy,n=r.Sprite,s=r._decorator,i=r.Color,c=r.Component}],execute:function(){var u;e._RF.push({},"958de1R6sBJ17spJuwpYWre","Territory",void 0);var p=s,l=p.ccclass;p.property,r("Territory",l("Territory")(u=function(r){function e(){for(var t,o=arguments.length,e=new Array(o),n=0;n<o;n++)e[n]=arguments[n];return(t=r.call.apply(r,[this].concat(e))||this).index=0,t.gridX=0,t.gridY=0,t.teamId=-1,t.map=null,t._sp=null,t}t(e,r);var s=e.prototype;return s.onLoad=function(){this._sp=this.getComponent(n)},s.onTouchEnd=function(r){},o(e,[{key:"color",get:function(){return this._sp?this._sp.color:i.WHITE},set:function(r){this._sp&&(this._sp.color=r)}}]),e}(c))||u);e._RF.pop()}}}));

System.register("chunks:///_virtual/TerritoryProtocol.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ProtocolBase.ts"],(function(t){"use strict";var r,e,o,n,i;return{setters:[function(t){r=t.inheritsLoose},function(t){e=t.cclegacy},function(t){o=t.ProtocolBase,n=t.PackageBase,i=t.MessageBase}],execute:function(){e._RF.push({},"a8fcd2NecZL8IgMpmfb/oe0","TerritoryProtocol",void 0);t("TerritoryProtocol",function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e}(o)),t("TerritoryPackage",function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e}(n)),t("TerritoryMessage",function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e}(i));e._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});